
@using YiZhan.Common.JsonModels
@model YiZhan.ViewModels.BusinessManagement.CommodityVM.YZ_OrderDataListVM
@{
    Layout = null;
}

<div class="area-right-head">
    <h3>订单管理</h3>
</div>
<div class="area-right-container">
    <!--tab栏 ：商品详细介绍、卖家介绍、购买须知、用户留言-->
    <div class="userCenterOrderArea" id="userCenterOrderArea">
        <ul class="nav nav-tabs userCenterOrderNav">
            <li class="active">
                <a class="order-menu-text" href="#Buyer" data-toggle="tab">购买管理</a>
            </li>
            <li>
                <a class="order-menu-text" href="#Seller" data-toggle="tab">出售管理</a>
            </li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane fade in active" id="Buyer">
                @*买家订单管理*@
                <ul class="nav nav-tabs userCenterOrderNav">
                    <li class="active">
                        <a href="#userAllOrdersWithBuyer" data-toggle="tab">全部订单</a>
                    </li>
                    <li>
                        <a href="#userAllOrdersDeliveryWithBuyer" data-toggle="tab">待发货</a>
                    </li>
                    <li>
                        <a href="#userAllOrdersCompleteWithBuyer" data-toggle="tab">已完成</a>
                    </li>
                </ul>
                <div class="tab-content">
                    <div class="tab-pane fade in active" id="userAllOrdersWithBuyer">
                        <div class="table-responsive">
                            <table class="table table-striped table-bordered text-center">
                                <thead>
                                    <tr style="height:40px">
                                        <th style="width:59px;" valign="middle">序号</th>
                                        <th style="width:100px;" valign="middle">订单号</th>
                                        <th style="width:100px;" valign="middle">商品名称</th>
                                        <th style="width:100px;" valign="middle">商品图</th>
                                        <th style="width:100px;" valign="middle">价格</th>
                                        <th style="width:120px;" valign="middle">下单时间</th>
                                        <th style="width:100px;" valign="middle">状态</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var item in Model.AllOrdersWithBuyer)
                                    {
                                        <tr>
                                            <td>@item.OrderNumber</td>
                                            <td>@item.Id</td>
                                            <td>@item.Commodity.Name</td>
                                            <td><img width="100" height="80" src="@item.Commodity.Images.FirstOrDefault(f=>f.Type==ImageType.CommodityCover).UploadPath" alt="商品图片" /></td>
                                            <td>@item.Price</td>
                                            <td>@item.CreateTime.ToString("yyyy-MM-dd hh:mm:ss")</td>
                                            <td>@item.State</td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                            @if (!Model.AllOrdersWithBuyer.Any())
                            {
                                <div class="center-block text-center" style="font-size:16px;"> 您还没有任何订单。</div>
                            }
                        </div>
                    </div>
                    <div class="tab-pane fade" id="userAllOrdersDeliveryWithBuyer">
                        <div class="table-responsive">
                            <table class="table table-striped table-bordered text-center">
                                <thead>
                                    <tr style="height:40px">
                                        <th style="width:59px;" valign="middle">序号</th>
                                        <th style="width:100px;" valign="middle">订单号</th>
                                        <th style="width:100px;" valign="middle">商品名称</th>
                                        <th style="width:100px;" valign="middle">商品图</th>
                                        <th style="width:100px;" valign="middle">价格</th>
                                        <th style="width:120px;" valign="middle">下单时间</th>
                                        <th style="width:100px;" valign="middle">状态</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var item in Model.WaitToSendOutOrdersWithBuyer)
                                    {
                                        <tr>
                                            <td>@item.OrderNumber</td>
                                            <td>@item.Id</td>
                                            <td>@item.Commodity.Name</td>
                                            <td><img width="100" height="80" src="@item.Commodity.Images.FirstOrDefault(f=>f.Type==ImageType.CommodityCover).UploadPath" alt="商品图片" /></td>
                                            <td>@item.Price</td>
                                            <td>@item.CreateTime.ToString("yyyy-MM-dd hh:mm:ss")</td>
                                            <td>@item.State</td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                            @if (!Model.WaitToSendOutOrdersWithBuyer.Any())
                            {
                                <div class="center-block text-center" style="font-size:16px;"> 您还没有任何订单。</div>
                            }

                        </div>

                    </div>
                    <div class="tab-pane fade" id="userAllOrdersCompleteWithBuyer">
                        <div class="table-responsive">
                            <table class="table table-striped table-bordered text-center">
                                <thead>
                                    <tr style="height:40px">
                                        <th style="width:59px;" valign="middle">序号</th>
                                        <th style="width:100px;" valign="middle">订单号</th>
                                        <th style="width:100px;" valign="middle">商品名称</th>
                                        <th style="width:100px;" valign="middle">商品图</th>
                                        <th style="width:100px;" valign="middle">价格</th>
                                        <th style="width:120px;" valign="middle">完成时间</th>
                                        <th style="width:100px;" valign="middle">状态</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var item in Model.SuccessOrdersWithBuyer)
                                    {
                                        <tr>
                                            <td>@item.OrderNumber</td>
                                            <td>@item.Id</td>
                                            <td>@item.Commodity.Name</td>
                                            <td><img width="100" height="80" src="@item.Commodity.Images.FirstOrDefault(f=>f.Type==ImageType.CommodityCover).UploadPath" alt="商品图片" /></td>
                                            <td>@item.Price</td>
                                            <td>@item.CompletionTime.ToString("yyyy-MM-dd hh:mm:ss")</td>
                                            <td>@item.State</td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                            @if (!Model.SuccessOrdersWithBuyer.Any())
                            {
                                <div class="center-block text-center" style="font-size:16px;"> 您还没有任何订单。</div>
                            }
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade" id="Seller">
                @*卖家订单管理*@
                <ul class="nav nav-tabs userCenterOrderNav">
                    <li class="active">
                        <a href="#userAllOrdersWithSeller" data-toggle="tab">全部订单</a>
                    </li>
                    <li>
                        <a href="#userAllOrdersDeliveryWithSeller" data-toggle="tab">待发货</a>
                    </li>
                    <li>
                        <a href="#userAllOrdersCompleteWithSeller" data-toggle="tab">已完成</a>
                    </li>
                </ul>

                <div class="tab-content">
                    <div class="tab-pane fade in active" id="userAllOrdersWithSeller">
                        <div class="table-responsive">
                            <table class="table table-striped table-bordered text-center">
                                <thead>
                                    <tr style="height:40px">
                                        <th style="width:59px;" valign="middle">序号</th>
                                        <th style="width:100px;" valign="middle">订单号</th>
                                        <th style="width:100px;" valign="middle">商品名称</th>
                                        <th style="width:100px;" valign="middle">商品图</th>
                                        <th style="width:100px;" valign="middle">价格</th>
                                        <th style="width:120px;" valign="middle">下单时间</th>
                                        <th style="width:100px;" valign="middle">状态</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var item in Model.AllOrdersWithSeller)
                                    {
                                        <tr>
                                            <td>@item.OrderNumber</td>
                                            <td>@item.Id</td>
                                            <td>@item.Commodity.Name</td>
                                            <td><img width="100" height="80" src="@item.Commodity.Images.FirstOrDefault(f=>f.Type==ImageType.CommodityCover).UploadPath" alt="商品图片" /></td>
                                            <td>@item.Price</td>
                                            <td>@item.CreateTime.ToString("yyyy-MM-dd hh:mm:ss")</td>
                                            <td>@item.State</td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                            @if (!Model.AllOrdersWithBuyer.Any())
                            {
                                <div class="center-block text-center" style="font-size:16px;"> 您还没有任何订单。</div>
                            }
                        </div>
                    </div>
                    <div class="tab-pane fade" id="userAllOrdersDeliveryWithSeller">
                        <div class="table-responsive">
                            <table class="table table-striped table-bordered text-center">
                                <thead>
                                    <tr style="height:40px">
                                        <th style="width:59px;" valign="middle">序号</th>
                                        <th style="width:100px;" valign="middle">订单号</th>
                                        <th style="width:100px;" valign="middle">商品名称</th>
                                        <th style="width:100px;" valign="middle">商品图</th>
                                        <th style="width:100px;" valign="middle">价格</th>
                                        <th style="width:120px;" valign="middle">下单时间</th>
                                        <th style="width:100px;" valign="middle">状态</th>
                                        <th style="width:150px;" valign="middle">数据操作</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var item in Model.WaitToSendOutOrdersWithSeller)
                                    {
                                        <tr>
                                            <td>@item.OrderNumber</td>
                                            <td>@item.Id</td>
                                            <td>@item.Commodity.Name</td>
                                            <td><img width="100" height="80" src="@item.Commodity.Images.FirstOrDefault(f=>f.Type==ImageType.CommodityCover).UploadPath" alt="商品图片" /></td>
                                            <td>@item.Price</td>
                                            <td>@item.CreateTime.ToString("yyyy-MM-dd hh:mm:ss")</td>
                                            <td>@item.State</td>
                                            <td>
                                                <div class="btn-group btn-group-xs" role="group" aria-label="...">
                                                    <button data-orderid="@item.Id" type="button" class="btn btn-default btn-send-out">立即发货</button>
                                                </div>
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                            @if (!Model.WaitToSendOutOrdersWithSeller.Any())
                            {
                                <div class="center-block text-center" style="font-size:16px;"> 您还没有任何订单。</div>
                            }

                        </div>

                    </div>
                    <div class="tab-pane fade" id="userAllOrdersCompleteWithSeller">
                        <div class="table-responsive">
                            <table class="table table-striped table-bordered text-center">
                                <thead>
                                    <tr style="height:40px">
                                        <th style="width:59px;" valign="middle">序号</th>
                                        <th style="width:100px;" valign="middle">订单号</th>
                                        <th style="width:100px;" valign="middle">商品名称</th>
                                        <th style="width:100px;" valign="middle">商品图</th>
                                        <th style="width:100px;" valign="middle">价格</th>
                                        <th style="width:120px;" valign="middle">完成时间</th>
                                        <th style="width:100px;" valign="middle">状态</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var item in Model.SuccessOrdersWithSeller)
                                    {
                                        <tr>
                                            <td>@item.OrderNumber</td>
                                            <td>@item.Id</td>
                                            <td>@item.Commodity.Name</td>
                                            <td><img width="100" height="80" src="@item.Commodity.Images.FirstOrDefault(f=>f.Type==ImageType.CommodityCover).UploadPath" alt="商品图片" /></td>
                                            <td>@item.Price</td>
                                            <td>@item.CompletionTime.ToString("yyyy-MM-dd hh:mm:ss")</td>
                                            <td>@item.State</td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                            @if (!Model.SuccessOrdersWithSeller.Any())
                            {
                                <div class="center-block text-center" style="font-size:16px;"> 您还没有任何订单。</div>
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    $(function () {
        $(".btn-send-out").on("click", function (e) {
            e.preventDefault();
            $.post("../../CommoditiesManager/SendOut", { id: $(this).data("orderid") }, function (data) {
                if (data.isOk) {
                    LoadMyOrdersView();
                    LoadDefaultViewCss(9);

                    toastr.success(data.message);
                    if (data.count <= 0) {
                        $(".notificationCount").hide();
                        $(".notificationCount").text("");
                    } else {
                        $(".notificationCount").show();
                        $(".notificationCount").text(data.count);
                    }
                } else {
                    toastr.warning(data.message);
                }
            })
        })
    })

</script>